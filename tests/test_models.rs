use mangadex_rust::types::*;
use serde_json::{Value};


#[test]
fn test_mangas() -> serde_json::Result<()> {
    let json_str = r#"
        {"limit": 2,"offset": 0,"results": [{"data": {"attributes": {"altTitles": [{"en": "I am the only the one who levels up"},{"en": "I level up alone"},{"en": "Na Honjaman Lebel-eob"},{"en": "Only I Level Up"},{"en": "Ore Dake Level Up na Ken"},{"en": "Поднятие уровня в одиночку"},{"en": "ノベル 俺だけレベルアップな件"},{"en": "我独自升级"},{"en": "나 혼자만 레벨업"}],"contentRating": "safe","createdAt": "2019-08-25T10:51:55+00:00","description": {"de": "Als sich vor zehn Jahren das „Gate“ öffnete und unsere Welt sich mit der von Monstern verband, erhielten einige normale Menschen die Macht, diese Monster zu jagen. Sie sind als die „Hunter“ bekannt. Doch nicht alle Hunter sind mächtig. Mein Name ist Jin-Woo Sung, ich bin ein Hunter mit Rang E. Ich bin ein Hunter, der selbst in den einfachsten Dungeons sein Leben riskieren muss, der „weltschwächste“. Da ich keine einzige, hervorstechende Fähigkeit habe, schaffte ich es kaum, das nötige Geld für den Zutritt zu den schwächsten Dungeons zu verdienen … jedenfalls, bis ich in einem Rang D Dungeon einen versteckten Dungeon mit der höchstmöglichen Schwierigkeit fand! Als ich dort letztendlich meinen Tod akzeptiert hatte, erhielt ich eine seltsame Macht, einen Questlog, den nur ich sehen konnte, ein Geheimnis, mit dem ich mein Level steigern konnte! Wenn ich die Quests erfülle und basierend auf den gestellten Aufgaben trainiere und Monster jage, steigt mein Level. Ich werde vom weltschwächsten Hunter zum stärksten Rang S Hunter![/spoiler]\r\n[hr]","en": "10 years ago, after “the Gate” that connected the real world with the monster world opened, some of the ordinary, everyday people received the power to hunt monsters within the Gate. They are known as \"Hunters\". However, not all Hunters are powerful. My name is Sung Jin-Woo, an E-rank Hunter. I'm someone who has to risk his life in the lowliest of dungeons, the \"World's Weakest\". Having no skills whatsoever to display, I barely earned the required money by fighting in low-leveled dungeons… at least until I found a hidden dungeon with the hardest difficulty within the D-rank dungeons! In the end, as I was accepting death, I suddenly received a strange power, a quest log that only I could see, a secret to leveling up that only I know about! If I trained in accordance with my quests and hunted monsters, my level would rise. Changing from the weakest Hunter to the strongest S-rank Hunter!\r\n[hr][b][u]Descriptions in Other Languages:[/u][/b]\r\n(German/Deutsch, Italian/Italiano, French/Français, Portuguese/Português (BR), Romanian / Română, Russian/Русский, Turkish / Türkçe)\r\n[spoiler]","fr": "Depuis qu'un portail connectant notre monde à un monde peuplé de monstres et de créatures en tout genre est apparu, des personnes \"ordinaires\" ont acquis la capacité de chasser ces derniers. On les appelle les chasseurs. Vous pensez qu'ils sont tous balaises ? Qu'ils sont des héros, des aventuriers comme on en voit dans les mangas ? Eh bien malheureusement pas tous. Sung Jin-Woo est le plus faible des chasseurs de rang E, autrement dit, le plus faible parmi les faibles. Il est donc surnommé par ses confrères chasseurs \"le faible\". En tout cas il l'était, jusqu'à ce qu'il se retrouve piégé dans un donjon et y acquière une capacité... étrange. Il peut désormais voir une interface lui montrant des quêtes. Va-t-il réussir à devenir le plus puissant des chasseurs ?[/spoiler][/spoiler]\r\n[hr][b][u]Links:[/u][/b]\r\n[*][url=https://www.youtube.com/watch?v=pvK1doFfnR0]Official Webtoon Trailer[/url]\r\n[*][url=https://www.tappytoon.com/en/comics/solo-leveling-official]Official English Translation (Tappytoon, digital)[/url]\r\n[*][url=https://www.webnovel.com/comic/15227640605485101]Official English Translation (Webnovel, digital)[/url]\r\n[*][url=https://yenpress.com/series-search/?series=solo+leveling+manga]Official English Translation (Yen Press, physical & digital)[/url]\r\n[*][url=https://www.webnovel.com/book/12507348206677105]Official English Translation of the Web Novel (Webnovel, digital)[/url]\r\n[*][url=https://yenpress.com/series-search/?series=solo+leveling+novel]Official English Translation of the Web Novel (Yen Press, physical & digital)[/url]\r\n[*][url=https://piccoma.com/web/product/5523?etype=episode]Official Japanese Translation (Picoma)[/url]\r\n[*][url=https://piccoma.com/web/product/5523?etype=volume]Official Japanese Translation of the Web Novel (Picoma)[/url]\r\n[*][url=https://www.kuaikanmanhua.com/web/topic/4319/]Official Chinese Translation (KuaikanManhua)[/url]\r\n[*][url=https://altraverse.de/manga/solo-leveling/]Official German Translation (Altraverse)[/url]\r\n[*][url=https://kakaopage.co.id/content/Solo-Leveling/3375/]Official Indonesian Translation (Kakaoid)[/url]\r\n[*][url=https://www.starcomics.com/]Official Italian Translation (Coming soon in April 2021)[/url]\r\n[*][url=https://www.verytoon.com/serie/solo-leveling/]Official French Translation (Webnovel, digital)[/url]","it": "10 anni fa, dopo l'apertura di “Portali” che connettono il mondo reale con quello dei mostri, gente comune ha ricevuto il potere di cacciare i mostri all'interno dei Portali. Sono conosciuti come \"Hunter\". Tuttavia, non tutti gli Hunter sono potenti. Il mio nome è Sung Jin-Woo, un Hunter di grado E, il \"più debole al mondo\". Senza particolari abilità a mia disposizione, guadagno la mia paga combattendo in dungeon di basso livello… Almeno finché non ho trovato un dungeon della massima difficoltà nascosto in un dungeon di grado D! Alla fine, mentre mi accingevo ad accettare la morte, ho ricevuto uno strano potere, un'interfaccia per le missioni che solo io posso vedere, un segreto per aumentare di livello di cui solo io sono a conoscenza! La trasformazione dal più debole al più forte Hunter di grado S![/spoiler]\r\n[hr]Portuguese (BR) / Português (BR)Dez anos atrás, depois do \"Portal\" que conecta o mundo real com um mundo de montros se abriu, algumas pessoas comuns receberam o poder de caçar os monstros do portal. Eles são conhecidos como caçadores. Porém, nem todos os caçadores são fortes. Meu nome é Sung Jin-Woo, um caçador de rank E. Eu sou alguém que tem que arriscar a própria vida nas dungeons mais fracas, \"O mais fraco do mundo\". Sem ter nenhuma habilidade à disposição, eu mal consigo dinheiro nas dungeons de baixo nível... Ao menos até eu encontrar uma dungeon escondida com a maior dificuldade dentro do Rank D! No fim, enquanto aceitava minha morte, eu ganhei um novo poder...[/spoiler]\r\n[hr]","ro": "Acum 10 ani, după ce “Poarta” care lega lumea reală de cea a monștrilor s-a dechis, unii oameni au primit puterea de a-i putea vâna. Ei sunt cunoscuți drept “Vânători”, dar nu toți vânătorii sunt puternici. Numele meu este Sung Jin-Woo, un vânător de rank E. Mi-am riscat viața chiar și în cele mai slabe temnițe, primind titlul de “Cel mai slab”. Neavând nici un skill, de abia făceam suficienți bani luptând în temnițe de nivel mic. Asta s-a schimbat când am găsit o temniță ascunsă de dificultate maximă într-o temniță de rank D! În cele din urmă, în timp ce-mi acceptam moartea, am primit o putere ciudată, un panou cu misiuni pe care doar eu îl puteam vedea. Un secret pentru a putea evolua pe care doar eu îl știam. Dacă mă antrenez după cum mă ghidează misiunile, nivelul meu crește. Devenind din “Cel mai slab” vânător cel mai puternic vânător de rank S![/spoiler]\r\n[hr]","ru": "10 лет назад, после того, как «Врата», соединившие реальный мир с параллельным, открылись, некоторые из людей получили силу охотиться на монстров внутри \"Врат\".Они известны как «Охотники». Однако не все Охотники сильные. Меня зовут Сун Джин-Ву, охотник E-ранга. Я тот, кто рискует своей жизнью в самых низких уровнях подземелья. Не имея никаких сверхсильных навыков, я едва зарабатывал необходимые деньги, сражаясь в низкоуровневых подземельях ... по крайней мере, пока я не нашел скрытое подземелье с самыми трудными проблемами в подземельях D-ранга! В конце концов, когда я умер, я внезапно получил странную силу, журнал заданий, который мог видеть только я, секрет для поднятия уровня, о котором знаю только я! Если бы я тренировался в соответствии с моими заданиями и охотился на монстров, мой уровень повышался. Переход от самого слабого Охотника к самому сильному, Охотнику S-ранга![/spoiler]\r\n[hr]","tr": "10 yıl önce, 'kapı' gerçek dünyayı canavar dünyasına bağlayıp açtıktan sonra, alışılmış biçimde, hergün insanlar canavarları avlamak için kapıya güçlerini yönlendirdiler. Bu kişiler 'avcılar' olarak biliniyor. Ne var ki, tüm avcılar güçlü değiller; \"Benim adım Sung Jin-Woo, ben E-Seviyeli bir avcıyım. Ben hayatımı en düşük zindanlarda tehlikeye atan birisiyim, \"dünyanın en zayıfı\". Herhangi bir yeteneği olmayan, zar zor ihtiyaçlarımı karşılayacak parayı düşük-seviyeli zindanlarda savaşarak kazanıyorum... En azından D-Seviyede gizli en zor zindanı bulana kadar! En sonunda, ölümü kabullendiğimde, aniden garip bir güç elde ettim, sadece benim görebileceğim bir görev ekranı, sadece benim bildiğim gizli bir seviye atlama yöntemi! Eğer görevlerime uygun olarak antrenman yapıp canavarları avlarsam, seviyem yükselecek, en zayıf avcı en güçlü S-Seviyeli avcıya dönüşecek! (Alıntı: MangaTR)[/spoiler]\r\n[hr]"},"lastChapter": null,"lastVolume": null,"links": {"al": "105398","ap": "solo-leveling","engtl": "https://www.tappytoon.com/en/comics/solo-leveling-official","kt": "54114","mal": "121496","mu": "151349","nu": "i-alone-level-up","raw": "https://page.kakao.com/home?seriesId=50866481"},"originalLanguage": "ko","publicationDemographic": "shounen","status": "ongoing","tags": [{"attributes": {"description": [],"group": "format","name": {"en": "Long Strip"},"version": 1},"id": "3e2b8dae-350e-4ab8-a8ce-016e844b9f0d","type": "tag"}],"title": {"en": "Solo Leveling"},"updatedAt": "2021-06-14T07:16:49+00:00","version": 4,"year": null},"id": "32d76d19-8a05-4db0-9fc2-e0b0648fe9d0","type": "manga"},"relationships": [{"id": "820b13ef-dc7d-42b1-999a-65393b8b4040","type": "author"},{"id": "86f43f7f-7f32-4ecb-8dd9-7cd2ae16932b","type": "artist"},{"id": "b6c7ce9c-e671-4f26-90b0-e592188e9cd6","type": "cover_art"}],"result": "ok"},{"data": {"attributes": {"altTitles": [{"en": "Εκεινη την στιγμη μετενσαρκωθηκα σαν γλιτσα."},{"en": "Aquella vez que me convertí en Slime"},{"en": "In Regards to My Reincarnation as a Slime"},{"en": "Moi, quand je me réincarne en Slime"},{"en": "Odrodzony jako galareta"},{"en": "Regarding Reincarnated to Slime"},{"en": "Ten Sura"},{"en": "Tensei Slime"},{"en": "TenSli"},{"en": "TenSura"},{"en": "That Time I Got Reincarnated as a Slime"},{"en": "Vita da Slime"},{"en": "О моём перерождении в слизь"},{"en": "เกิดใหม่ทั้งทีก็เป็นสไลม์ไปซะแล้ว"},{"en": "关于我转生后成为史莱姆的那件事"},{"en": "転生したらスライムだった件"},{"en": "전생했더니 슬라임이었던건에 대하여"}],"contentRating": "safe","createdAt": "2018-11-05T01:59:35+00:00","description": {"en": "The ordinary Mikami Satoru found himself dying after being stabbed by a slasher. It should have been the end of his meager 37 years, but he found himself deaf and blind after hearing a mysterious voice.\r\nHe had been reincarnated into a slime!\r\n\r\nWhile complaining about becoming the weak but famous slime and enjoying the life of a slime at the same time, Mikami Satoru met with the Catastrophe-level monster “Storm Dragon Veldora”, and his fate began to move.Português (BR)/ Portuguese (BR)[/u][/b]\r\n[spoiler]Depois de ser morto por um ladrão que fugia, um rapaz normal de 37 anos de idade se encontra reencarnado em um outro mundo como um slime cego com habilidades únicas. Com um novo nome \"Rimuru Tempest\" ele chegou depois de conhecer seu novo amigo, o \"nível catástrofe\", Dragão da Tempestade Verudora, ele começa sua vida de slime em outro mundo com seu crescente número de seguidores.","ru": "37-летний японец-холостяк был зарезан на улице каким-то мерзавцем-грабителем. Тут бы и истории конец, да всё обернулось иначе, неожиданно он переродился слизью в фэнтезийном мире. Но что может сделать, пускай и разумная, но слизь?[/spoiler]\r\n[hr][b]Links:[/b]\r\n[*][url=https://www.animenewsnetwork.com/encyclopedia/anime.php?id=20736]Anime Season 1 on ANN[/url]"},"lastChapter": null,"lastVolume": null,"links": {"al": "86399","amz": "https://www.amazon.co.jp/gp/product/B074CFC3N4","ap": "that-time-i-got-reincarnated-as-a-slime","bw": "series/56105","cdj": "http://www.cdjapan.co.jp/product/NEOBK-1858955","ebj": "https://ebookjapan.yahoo.co.jp/books/334900","engtl": "https://kodanshacomics.com/series/time-got-reincarnated-slime","kt": "35483","mal": "87609","mu": "119910","nu": "tensei-shitara-slime-datta-ken"},"originalLanguage": "ja","publicationDemographic": "shounen","status": "ongoing","tags": [{"attributes": {"description": [],"group": "theme","name": {"en": "Reincarnation"},"version": 1},"id": "0bc90acb-ccc1-44ca-a34a-b9f3a73259d0","type": "tag"},{"attributes": {"description": [],"group": "theme","name": {"en": "Monsters"},"version": 1},"id": "36fd93ea-e8b8-445e-b836-358f02b3d33d","type": "tag"},{"attributes": {"description": [],"group": "genre","name": {"en": "Action"},"version": 1},"id": "391b0423-d847-456f-aff0-8b0cfc03066b","type": "tag"},{"attributes": {"description": [],"group": "theme","name": {"en": "Demons"},"version": 1},"id": "39730448-9a5f-48a2-85b0-a70db87b1233","type": "tag"},{"attributes": {"description": [],"group": "genre","name": {"en": "Comedy"},"version": 1},"id": "4d32cc48-9f00-4cca-9b5a-a839f0764984","type": "tag"},{"attributes": {"description": [],"group": "theme","name": {"en": "Samurai"},"version": 1},"id": "81183756-1453-4c81-aa9e-f6e1b63be016","type": "tag"},{"attributes": {"description": [],"group": "genre","name": {"en": "Adventure"},"version": 1},"id": "87cc87cd-a395-47af-b27a-93258283bbc6","type": "tag"},{"attributes": {"description": [],"group": "theme","name": {"en": "Magic"},"version": 1},"id": "a1f53773-c69a-4ce5-8cab-fffcd90b1565","type": "tag"},{"attributes": {"description": [],"group": "genre","name": {"en": "Isekai"},"version": 1},"id": "ace04997-f6bd-436e-b261-779182193d3d","type": "tag"},{"attributes": {"description": [],"group": "genre","name": {"en": "Drama"},"version": 1},"id": "b9af3a63-f058-46de-a9a0-e0c13906197a","type": "tag"},{"attributes": {"description": [],"group": "genre","name": {"en": "Fantasy"},"version": 1},"id": "cdc58593-87dd-415e-bbc0-2ec27bf404cc","type": "tag"},{"attributes": {"description": [],"group": "theme","name": {"en": "Monster Girls"},"version": 1},"id": "dd1f77c5-dea9-4e2b-97ae-224af09caf99","type": "tag"},{"attributes": {"description": [],"group": "format","name": {"en": "Adaptation"},"version": 1},"id": "f4122d1c-3b44-44d0-9936-ff7502c39ad3","type": "tag"}],"title": {"en": "Tensei Shitara Slime Datta Ken"},"updatedAt": "2021-05-25T15:48:59+00:00","version": 2,"year": null},"id": "e78a489b-6632-4d61-b00b-5206f5b8b22b","type": "manga"},"relationships": [{"id": "dbf8af05-7173-49f3-bf60-f4ea3f586486","type": "author"},{"id": "560748c6-fbe7-49f5-8258-7b3292942101","type": "artist"},{"id": "0ecefb70-e710-4f5a-94c0-d3a01db0a5a5","type": "cover_art"}],"result": "ok"}],"total": 43127}
    "#;
    let v: Value = serde_json::from_str(json_str)?;

    let mut mangas: Vec<Manga> = Vec::new();
    for m in v["results"].as_array().unwrap().iter() {
        mangas.push(Manga::from(m.to_owned()));
    }
    assert_eq!(mangas.len(), 2);
    assert_eq!(mangas[0].title["en"], "Solo Leveling");
    assert_eq!(mangas[1].title["en"], "Tensei Shitara Slime Datta Ken");
    assert_eq!(mangas[1].author.id, "dbf8af05-7173-49f3-bf60-f4ea3f586486"); 
    Ok(())
}

#[test]
fn test_get_manga() ->  serde_json::Result<()>{
    let json_str = r#"
        {"result": "ok","data": {"id": "a96676e5-8ae2-425e-b549-7f15dd34a6d8","type": "manga","attributes": {"title": {"en": "Komi-san wa Komyushou Desu."},"altTitles": [{"en": "Comi-san ha Comyusho Desu."},{"en": "Komi Can't Communicate"},{"en": "Komi-san Can't Communicate."},{"en": "Komi-san Has a Communication Disorder."},{"en": "Komi-san wa Komyushou Desu"},{"en": "Komi-san wa, Communication Shougai desu."},{"en": "Komi-san wa, Comyushou desu."},{"en": "Komi-san wa, Komyushou desu."},{"en": "Miss Komi Is Bad at Communication."},{"en": "У Коми-сан проблемы с общением"},{"en": "โฉมงามพูดไม่เก่งกับผองเพื่อนไม่เต็มเต็ง"},{"en": "古見さんは、コミュ症です。"},{"en": "古見同學有交流障礙症"},{"en": "코미 양은, 커뮤증이에요"}],"description": {"en": "Komi-san is a beautiful and admirable girl that no one can take their eyes off of. Almost the whole school sees her as the cold beauty that's out of their league, but Tadano Hitohito knows the truth: she's just really bad at communicating with others. \r\n\r\nKomi-san, who wishes to fix this bad habit of hers, tries to improve it with the help of Tadano-kun by achieving her goal of having 100 friends.\r\n\r\n[b]Links:[/b] [url=https://twitter.com/ooodaaaatooo]Author's Twitter[/url]\r\n\r\nComi-san ha Comyusho Desu. is the official romanization.\r\n\r\nPL\r\n\r\n[spoiler]Komi-san jest piękną i godną podziwu dziewczyną, od której nikt nie może oderwać oczu. Prawie cała szkoła postrzega ją jako zimne piękno, które jest poza ich zasięgiem, ale Tadano Hitohito zna prawdę: młoda piękność po prostu źle komunikuje się z innymi. Komi-san, chce to zmienić, a ma jej w tym pomóc Tadano.[/spoiler]"},"links": {"al": "97852","ap": "komi-cant-communicate","bw": "series/129153","dj": "958365","kt": "37855","mu": "127281","amz": "https://www.amazon.co.jp/gp/product/B07CBD8DKM","cdj": "http://www.cdjapan.co.jp/product/NEOBK-1985640","ebj": "https://www.ebookjapan.jp/ebj/382444/","mal": "99007","raw": "https://websunday.net/rensai/komisan/","engtl": "https://www.viz.com/komi-can-t-communicate"},"originalLanguage": "ja","lastVolume": null,"lastChapter": null,"publicationDemographic": "shounen","status": "ongoing","year": null,"contentRating": "safe","tags": [{"id": "423e2eae-a7a2-4a8b-ac03-a8351462d71d","type": "tag","attributes": {"name": {"en": "Romance"},"description": [],"group": "genre","version": 1}},{"id": "4d32cc48-9f00-4cca-9b5a-a839f0764984","type": "tag","attributes": {"name": {"en": "Comedy"},"description": [],"group": "genre","version": 1}},{"id": "caaa44eb-cd40-4177-b930-79d3ef2afe87","type": "tag","attributes": {"name": {"en": "School Life"},"description": [],"group": "theme","version": 1}},{"id": "e5301a23-ebd9-49dd-a0cb-2add944c7fe9","type": "tag","attributes": {"name": {"en": "Slice of Life"},"description": [],"group": "genre","version": 1}}],"createdAt": "2018-11-22T23:31:37+00:00","updatedAt": "2021-05-25T15:46:17+00:00","version": 2}},"relationships": [{"id": "4218b1ee-cde4-44dc-84c7-d9a794a7e56d","type": "author"},{"id": "4218b1ee-cde4-44dc-84c7-d9a794a7e56d","type": "artist"},{"id": "3730193d-a00f-4f67-a3c8-92118d857c31","type": "cover_art"}]}
    "#;
    let v: Value = serde_json::from_str(json_str)?;
    let manga: Manga = Manga::from(v);
    assert_eq!(manga.title["en"], "Komi-san wa Komyushou Desu.");
    assert_eq!(manga.original_language, "ja");
    let sol: MangaTag = MangaTag {
        id: "e5301a23-ebd9-49dd-a0cb-2add944c7fe9".to_string(),
        name: "Slice of Life".to_string()
    };
    assert_eq!(manga.tags.contains(&sol),true);
    assert_eq!(manga.author.id, "4218b1ee-cde4-44dc-84c7-d9a794a7e56d");
    Ok(())
}
